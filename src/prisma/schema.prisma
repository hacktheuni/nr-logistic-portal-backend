  generator client {
    provider = "prisma-client"
    output   = "./generated"
  }

  datasource db {
    provider = "postgresql"
  }


enum RoundStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ParcelStatus {
  MANIFESTED
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
  CFWD 
}


model Admin {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  appEmail      String   
  appPassword   String   
  appCourierId  String   @unique
  createdAt     DateTime @default(now())
}

model Driver {
  id                  String   @id @default(uuid())
  name                String
  email               String   @unique
  appDriverID         String?  @unique
  rate                Float    

  // Relationships
  assignments         RoundAssignment[]
  manifestItems       ManifestItem[]
  earnings            DriverEarning[]
}

model Round {
  id                   String   @id @default(uuid())
  roundNumber          String
  roundDate            DateTime
  deliveryUnitLocation String?
  dropNumber           Int?
  status               RoundStatus @default(PENDING)
  postCodes            String[]
  globalRates          Json?

  // Relationships
  assignments          RoundAssignment[]
  manifests            Manifest[]
  earnings             DriverEarning[]
}

model RoundAssignment {
  id            String    @id @default(uuid())
  roundId       String
  driverId      String
  assignedAt    DateTime  @default(now())
  unassignedAt  DateTime? 

  round         Round     @relation(fields: [roundId], references: [id])
  driver        Driver    @relation(fields: [driverId], references: [id])
}

model Manifest {
  id                   String   @id @default(uuid())
  roundId              String
  manifestNumber       String
  totalManifestItems   Int      @default(0)
  totalDelivered       Int      @default(0)
  totalCarryForward    Int      @default(0)

  round                Round    @relation(fields: [roundId], references: [id])
  items                ManifestItem[]
}

model ManifestItem {
  id           String    @id @default(uuid())
  manifestId   String
  driverId     String?   
  type         String?
  barcode      String    @unique
  address      String?
  status       ParcelStatus @default(MANIFESTED)
  scannedAt    DateTime? 

  manifest     Manifest  @relation(fields: [manifestId], references: [id])
  driver       Driver?   @relation(fields: [driverId], references: [id])
}

model Review {
  id             String   @id @default(uuid())
  rating         Int      
  comment        String?
  hasBadges      Boolean  @default(false)
  createdAt      DateTime @default(now())
}

model DriverEarning {
  id              String   @id @default(uuid())
  roundId         String
  driverId        String
  totalDelivered  Int      @default(0)
  totalAmount     Decimal  @db.Decimal(10, 2)
  calculatedAt    DateTime @default(now())

  round           Round    @relation(fields: [roundId], references: [id])
  driver          Driver   @relation(fields: [driverId], references: [id])
}