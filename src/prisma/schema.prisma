  generator client {
    provider = "prisma-client"
    output   = "./generated"
  }

  datasource db {
    provider = "postgresql"
  }

  // --- ENUMS ---

enum RoundStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ParcelStatus {
  Delivered_Collected
  Unable_To_Deliver_Collect
  CarryForward
  MissingParcel
}

// --- TABLES ---

model Admin {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  appEmail      String   // Store Encrypted
  appPassword   String   // Store Encrypted
  appCourierId  String   @unique
  createdAt     DateTime @default(now())
}

model Driver {
  id                  String   @id @default(uuid())
  name                String
  email               String   @unique
  appDriverID         String?  @unique
  ratePerTypeOfParcel Json?    // Flexible rates for different parcel types

  // Relationships
  assignments         RoundAssignment[]
  manifestItems       ManifestItem[]
  earnings            DriverEarning[]
}

model Round {
  id                   String   @id @default(uuid())
  roundNumber          String
  roundDate            DateTime
  deliveryUnitLocation String?
  dropNumber           Int?
  status               RoundStatus @default(PENDING)
  postCodes            String[]
  globalRates          Json?

  // Relationships
  assignments          RoundAssignment[]
  manifests            Manifest[]
  earnings             DriverEarning[]
}

// Junction table to handle multiple drivers per round (Shifting Logic)
model RoundAssignment {
  id            String    @id @default(uuid())
  roundId       String
  driverId      String
  assignedAt    DateTime  @default(now())
  unassignedAt  DateTime? // Null means this is the driver currently working the round

  round         Round     @relation(fields: [roundId], references: [id])
  driver        Driver    @relation(fields: [driverId], references: [id])
}

model Manifest {
  id                   String   @id @default(uuid())
  roundId              String
  manifestNumber       String
  totalManifestItems   Int      @default(0)
  totalDelivered       Int      @default(0)
  totalCarryForward    Int      @default(0)

  round                Round    @relation(fields: [roundId], references: [id])
  items                ManifestItem[]
}

model ManifestItem {
  id           String    @id @default(uuid())
  manifestId   String
  driverId     String?   // Tracks exactly who delivered this barcode
  type         String?
  barcode      String    @unique
  address      String?
  status       ParcelStatus @default(MANIFESTED)
  scannedAt    DateTime? // Timestamp of the specific scan event

  manifest     Manifest  @relation(fields: [manifestId], references: [id])
  driver       Driver?   @relation(fields: [driverId], references: [id])
}

// Independent Review Table
model Review {
  id             String   @id @default(uuid())
  customerName   String?
  rating         Int      // 1-5 Stars
  comment        String?
  hasBadges      Boolean  @default(false)
  isCommentOnly  Boolean  @default(false)
  createdAt      DateTime @default(now())
}

model DriverEarning {
  id              String   @id @default(uuid())
  roundId         String
  driverId        String
  totalDelivered  Int      @default(0)
  totalAmount     Decimal  @db.Decimal(10, 2)
  calculatedAt    DateTime @default(now())

  round           Round    @relation(fields: [roundId], references: [id])
  driver          Driver   @relation(fields: [driverId], references: [id])
}